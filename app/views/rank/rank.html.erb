<% require 'github_helper' %>

<h1>Ruby Course rank</h1>
<%= button_to "Refresh table", action: "refresh" %>

<table>

  <thead>
    <tr>
      <th>Milestones</th>
      <% @milestones.each do |milestone| %>
          <th colspan=<%= milestone.tasks.size %>><%= milestone.title %></th>
      <% end %>
    </tr>
    <tr>
      <th>Tasks</th>
      <% @tasks.each do |task| %>
        <th><%= task.title %></th>
      <% end %>
    </tr>
  </thead>

  <tbody>
    <% @students.each do |student| %>
    <tr>
      <td><%= student.github_login %></td>
      <% @tasks.each do |task| %>
          <% student_task = student.student_tasks.find { |st| st.task == task } %>
          <td>
            <% if !student_task.nil? %>
                <a href=<%= GithubHelper.get_issue_url(student, task, REPO_NAME) %> target="_blank">
                  <%= student_task.state %>
                </a>
            <% else %>
                -
            <% end %>
          </td>
      <% end %>
    </tr>
    <% end %>
  </tbody>

</table>